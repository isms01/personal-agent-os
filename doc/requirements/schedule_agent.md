# Schedule Agent 要件定義書

**作成日:** 2024-12-15  
**作成者:** Masa  
**プロジェクト:** backend-evolve

---

## 1. 目的

物理的に実現不可能なスケジュールを防ぐインテリジェントなスケジュール管理システムを構築する。

---

## 2. 解決する課題

**問題:**  
予定を詰め込みすぎて、移動時間が物理的に間に合わない → 遅刻・混乱・信用低下

**ターゲットユーザー:**
- 予定が多い人（経営者、営業、コンサルタント等）
- 秘書やアシスタント

---

## 3. コア機能要件

### 3.1 必須機能

| 機能                       | 説明                                                   |
| -------------------------- | ------------------------------------------------------ |
| **物理実現性チェック**     | 前後の予定間の移動時間を考慮し、物理的に成立するか判定 |
| **必須情報バリデーション** | 案件名・場所・時間の入力完全性チェック                 |
| **Accept/Reject判定**      | Claude APIによる判定結果の提示                         |
| **対話的修正プロンプト**   | 入力不備がある場合の再入力要求                         |

### 3.2 入力要件

**必須入力項目:**
1. 案件名（イベント名）
2. 場所（住所または座標）
3. 開始時刻
4. 終了時刻

**入力チェック:**
- 上記4項目すべてが入力されているか
- 抜けがあれば標準入力で再入力を促す

### 3.3 判定ロジック

```
判定基準:
利用可能時間 = 次の予定開始時刻 - 前の予定終了時刻
必要時間 = 移動時間 + バッファ時間（5分）

if 利用可能時間 >= 必要時間:
    → Accept
else:
    → Reject（理由を提示）
```

---

## 4. 技術要件

### 4.1 移動時間取得

**選択:** OSRM (OpenStreetMap Routing Machine)

**理由:**
- 完全無料
- セルフホスト可能
- プロダクトレベルの証明には十分な精度

### 4.2 インターフェース

**優先順位:**
1. CUI（CLI）- MVP
2. GUI - 後から検討

**理由:** 早く動くものを作る（Pragmatic First）

### 4.3 アーキテクチャ

```
User Input 
  ↓
Validation Agent（入力チェック）
  ↓
Location/Time Check（OSRM呼び出し）
  ↓
Claude判定（Accept/Reject）
  ↓
結果出力
```

---

## 5. 非機能要件

### 5.1 コスト制約

- **外部API費用: $0**
- OSRMセルフホストのみ使用

### 5.2 精度要件

- 移動時間の精度は問わない
- 「物理的に成立するか」の判定ができればOK

### 5.3 スケーラビリティ

- 初期はシングルユーザー想定
- 複数ユーザー対応は将来拡張

---

## 6. 成功基準

### 6.1 MVP（Minimum Viable Product）

- [ ] 2つの連続する予定の実現性を判定できる
- [ ] 移動時間をOSRMで取得できる
- [ ] Accept/Rejectの理由を提示できる
- [ ] 必須項目の入力チェックができる

### 6.2 プロダクトレベル

- [ ] 入力がわかりやすい
- [ ] 判定理由が明確
- [ ] エラーハンドリングが適切

---

## 7. スコープ外（やらないこと）

- カレンダー連携（初期版）
- 複雑なスケジュール最適化
- リアルタイム交通情報
- モバイルアプリ
- マルチユーザー管理

---

## 8. 開発原則（FOUNDATION準拠）

1. **Pragmatic First** - 完璧より動くもの
2. **Learn By Building** - 計画より実装
3. **Explainability** - ブラックボックスなし

---

## 9. 開発フェーズ

### Phase 1: コアエンジン（今週）
- OSRMセットアップ
- 2予定間の判定ロジック実装

### Phase 2: 入力インターフェース
- CLI実装
- バリデーション実装

### Phase 3: Claude統合
- 判定理由の自然言語生成

---

**備考:**  
この要件定義はMVPに焦点を当てており、プロダクトレベルに到達するための最小限の機能を定義している。